<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTTPMP3 Decoder - Protocol %</title>
    <link rel="stylesheet" href="shared-styles.css">
    <style>
        .main-content {
            padding: 120px 0 80px;
            min-height: 100vh;
        }

        .page-header {
            text-align: center;
            margin-bottom: 60px;
        }

        .page-title {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 16px;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.03em;
        }

        .page-subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        .decoder-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        .upload-section {
            background: var(--card-bg);
            border: 2px dashed var(--card-border);
            border-radius: var(--border-radius-lg);
            padding: 40px;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .upload-section:hover {
            border-color: rgba(79, 172, 254, 0.5);
            background: rgba(79, 172, 254, 0.02);
        }

        .upload-section.dragover {
            border-color: var(--accent-gradient);
            background: rgba(79, 172, 254, 0.05);
        }

        .upload-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 24px;
            padding: 16px;
            background: var(--accent-gradient);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .upload-icon svg {
            width: 32px;
            height: 32px;
            fill: white;
        }

        .file-input {
            display: none;
        }

        .file-input-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 32px;
            background: var(--accent-gradient);
            color: white;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .file-input-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
        }

        .controls-section {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .ai-toggle {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--border-radius);
            padding: 24px;
            backdrop-filter: blur(10px);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--card-border);
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: var(--success-gradient);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .analysis-section {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--border-radius-lg);
            padding: 32px;
            backdrop-filter: blur(10px);
            margin-bottom: 40px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--card-border);
            border-radius: 4px;
            overflow: hidden;
            margin: 16px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-gradient);
            width: 0%;
            transition: width 0.3s ease;
        }

        .frequency-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }

        .frequency-item {
            background: rgba(79, 172, 254, 0.1);
            border: 1px solid rgba(79, 172, 254, 0.3);
            border-radius: var(--border-radius);
            padding: 16px;
            text-align: center;
        }

        .frequency-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4facfe;
            margin-bottom: 4px;
        }

        .frequency-char {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .output-section {
            display: none;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--border-radius-lg);
            padding: 32px;
            backdrop-filter: blur(10px);
        }

        .output-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--card-border);
        }

        .tab-button {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            color: var(--text-primary);
            background: var(--card-bg);
            border-bottom: 2px solid #4facfe;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .html-preview {
            background: var(--dark-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--border-radius);
            padding: 20px;
            font-family: 'Fira Code', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }

        .website-preview {
            width: 100%;
            height: 500px;
            border: 1px solid var(--card-border);
            border-radius: var(--border-radius);
            background: white;
        }

        .ai-validation {
            background: rgba(67, 233, 123, 0.1);
            border: 1px solid rgba(67, 233, 123, 0.3);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
        }

        .ai-validation h4 {
            color: #43e97b;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .validation-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .validation-check {
            width: 16px;
            height: 16px;
            fill: #43e97b;
        }

        @media (max-width: 768px) {
            .decoder-grid {
                grid-template-columns: 1fr;
            }
            
            .page-title {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    
    <!-- Navigation -->
    <nav class="nav" id="navbar">
        <div class="nav-content">
            <div class="logo">Protocol %</div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="generator.html">Generator</a></li>
                <li><a href="decoder.html">Decoder</a></li>
                <li><a href="frequency_analyzer.html">Analyzer</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="https://github.com/nia-cloud-official/httpmp3" target="_blank">GitHub</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <h1 class="page-title">HTTPMP3 Decoder</h1>
                <p class="page-subtitle">
                    Transform audio frequencies back into websites with AI-enhanced validation and real-time analysis
                </p>
            </div>

            <!-- Upload and Controls -->
            <div class="decoder-grid">
                <div class="upload-section" id="uploadSection">
                    <div class="upload-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                    </div>
                    <h3 style="margin-bottom: 16px; color: var(--text-primary);">Upload Audio File</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 24px;">
                        Select or drag & drop your HTTPMP3 audio file
                    </p>
                    <input type="file" id="audioFile" class="file-input" accept="audio/*">
                    <label for="audioFile" class="file-input-label">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        Choose Audio File
                    </label>
                    <p style="color: var(--text-muted); font-size: 0.9rem; margin-top: 16px;">
                        Supports WAV, MP3, and other audio formats
                    </p>
                </div>

                <div class="controls-section">
                    <div class="ai-toggle">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <div>
                                <h4 style="color: var(--text-primary); margin-bottom: 4px;">AI Validation</h4>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">
                                    Use ChatGPT to validate and correct decoded HTML
                                </p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="aiValidation" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div id="aiApiKey" style="display: none;">
                            <input type="password" class="form-input" placeholder="Enter OpenAI API Key" id="apiKeyInput">
                            <p style="color: var(--text-muted); font-size: 0.8rem; margin-top: 8px;">
                                Your API key is stored locally and never sent to our servers
                            </p>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="decodeAudio()" id="decodeBtn" disabled>
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M8,5.14V19.14L19,12.14L8,5.14Z"/>
                        </svg>
                        Decode Audio
                    </button>
                </div>
            </div>

            <!-- Analysis Section -->
            <div class="analysis-section" id="analysisSection" style="display: none;">
                <h3 style="margin-bottom: 16px; color: var(--text-primary);">Analysis Progress</h3>
                <div id="statusMessage" class="status-message status-info">Ready to decode</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="frequency-display" id="frequencyDisplay"></div>
            </div>

            <!-- Output Section -->
            <div class="output-section" id="outputSection">
                <h3 style="margin-bottom: 24px; color: var(--text-primary);">Decoded Results</h3>
                
                <div class="output-tabs">
                    <button class="tab-button active" onclick="switchTab('html')">HTML Code</button>
                    <button class="tab-button" onclick="switchTab('preview')">Website Preview</button>
                    <button class="tab-button" onclick="switchTab('analysis')">Frequency Analysis</button>
                </div>

                <div class="tab-content active" id="htmlTab">
                    <div class="html-preview" id="decodedHTML"></div>
                    <div class="ai-validation" id="aiValidationResults" style="display: none;">
                        <h4>
                            <svg class="validation-check" viewBox="0 0 24 24">
                                <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M11,16.5L6.5,12L7.91,10.59L11,13.67L16.59,8.09L18,9.5L11,16.5Z"/>
                            </svg>
                            AI Validation Results
                        </h4>
                        <div id="validationDetails"></div>
                    </div>
                </div>

                <div class="tab-content" id="previewTab">
                    <iframe class="website-preview" id="websitePreview"></iframe>
                </div>

                <div class="tab-content" id="analysisTab">
                    <div id="frequencyAnalysisResults"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Enhanced frequency matching with 10Hz tolerance and best match algorithm
        function getFrequencyChar(detectedFreq) {
            const characters = [];
            
            // Build character frequency map
            for (let ascii = 32; ascii <= 126; ascii++) {
                const expectedFreq = 600 + (ascii - 32) * 15;
                characters.push({
                    char: String.fromCharCode(ascii),
                    freq: expectedFreq,
                    ascii: ascii
                });
            }
            
            // Find closest match within 10Hz tolerance
            let bestMatch = null;
            let bestDistance = Infinity;
            
            for (const charData of characters) {
                const distance = Math.abs(detectedFreq - charData.freq);
                if (distance < bestDistance && distance <= 10) {
                    bestDistance = distance;
                    bestMatch = charData;
                }
            }
            
            if (bestMatch) {
                console.log(`✓ Match: ${detectedFreq.toFixed(1)}Hz -> ${bestMatch.freq}Hz -> '${bestMatch.char}' (±${bestDistance.toFixed(1)}Hz)`);
                return bestMatch.char;
            }
            
            console.log(`✗ No match for ${detectedFreq.toFixed(1)}Hz (tolerance: 10Hz)`);
            return null;
        }

        // AI validation using ChatGPT API
        async function validateWithAI(htmlContent) {
            const apiKey = document.getElementById('apiKeyInput').value;
            if (!apiKey) {
                throw new Error('OpenAI API key required for AI validation');
            }

            const prompt = `Please analyze and validate this HTML content decoded from audio frequencies. Fix any obvious errors, ensure proper structure, and return clean, valid HTML:

${htmlContent}

Requirements:
1. Fix any malformed tags or syntax errors
2. Ensure proper HTML structure (DOCTYPE, html, head, body if needed)
3. Correct any character encoding issues
4. Maintain the original intent and content
5. Return only the corrected HTML, no explanations

Corrected HTML:`;

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: 'You are an HTML validation and correction expert. Fix HTML errors and return clean, valid code.'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        max_tokens: 2000,
                        temperature: 0.1
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0].message.content.trim();
            } catch (error) {
                console.error('AI validation error:', error);
                throw error;
            }
        }

        // Enhanced audio decoding with progress tracking
        async function decodeAudio() {
            const fileInput = document.getElementById('audioFile');
            if (!fileInput.files[0]) {
                showStatus('Please select an audio file first!', 'error');
                return;
            }
            
            const analysisSection = document.getElementById('analysisSection');
            const outputSection = document.getElementById('outputSection');
            const frequencyDisplay = document.getElementById('frequencyDisplay');
            
            analysisSection.style.display = 'block';
            outputSection.style.display = 'none';
            frequencyDisplay.innerHTML = '';
            
            showStatus('Loading and analyzing audio file...', 'info');
            updateProgress(0);
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const arrayBuffer = await fileInput.files[0].arrayBuffer();
                const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
                
                showStatus('Performing frequency analysis with enhanced matching...', 'info');
                
                const sampleRate = audioBuffer.sampleRate;
                const data = audioBuffer.getChannelData(0);
                const fftSize = 2048;
                const hopSize = Math.floor(sampleRate * 1.3);
                
                let decodedText = '';
                let isReceiving = false;
                let totalAnalyzed = 0;
                let frequencyLog = [];
                
                console.log('Starting enhanced frequency analysis...');
                
                for (let i = 0; i < data.length - fftSize; i += hopSize) {
                    const slice = data.slice(i, i + fftSize);
                    const frequencies = performFFT(slice, sampleRate);
                    totalAnalyzed++;
                    
                    const progress = (i / data.length) * 100;
                    updateProgress(progress);
                    
                    if (frequencies.peak.magnitude > 0.1) {
                        const freq = frequencies.peak.frequency;
                        const time = (i / sampleRate).toFixed(2);
                        
                        let char = '';
                        let type = 'Unknown';
                        
                        if (Math.abs(freq - 440) < 15) {
                            type = 'Frame Start';
                            isReceiving = false;
                        } else if (Math.abs(freq - 500) < 15) {
                            type = 'Data Start';
                            isReceiving = true;
                        } else if (Math.abs(freq - 2100) < 15) {
                            type = 'Data End';
                            isReceiving = false;
                        } else if (Math.abs(freq - 2200) < 15) {
                            type = 'Frame End';
                        } else if (freq >= 590 && freq <= 2020 && isReceiving) {
                            char = getFrequencyChar(freq);
                            type = 'Data';
                            if (char) {
                                decodedText += char;
                                addFrequencyDisplay(freq, char);
                            }
                        }
                        
                        frequencyLog.push({
                            time: parseFloat(time),
                            frequency: freq,
                            magnitude: frequencies.peak.magnitude,
                            type: type,
                            character: char
                        });
                    }
                    
                    if (totalAnalyzed % 5 === 0) {
                        await new Promise(resolve => setTimeout(resolve, 1));
                    }
                }
                
                updateProgress(100);
                showStatus(`Decoding complete! Found ${decodedText.length} characters`, 'success');
                
                // Display results
                document.getElementById('decodedHTML').textContent = decodedText;
                document.getElementById('frequencyAnalysisResults').innerHTML = generateAnalysisReport(frequencyLog);
                
                // AI Validation if enabled
                if (document.getElementById('aiValidation').checked) {
                    try {
                        showStatus('Validating HTML with AI...', 'info');
                        const validatedHTML = await validateWithAI(decodedText);
                        
                        document.getElementById('decodedHTML').textContent = validatedHTML;
                        showAIValidation(decodedText, validatedHTML);
                        showStatus('AI validation complete!', 'success');
                    } catch (error) {
                        console.error('AI validation failed:', error);
                        showStatus('Decoding complete (AI validation failed)', 'warning');
                    }
                }
                
                // Show website preview
                document.getElementById('websitePreview').srcdoc = document.getElementById('decodedHTML').textContent;
                
                outputSection.style.display = 'block';
                
            } catch (error) {
                showStatus('Error: ' + error.message, 'error');
                console.error('Decoding error:', error);
            }
        }

        // UI Helper Functions
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = `status-message status-${type}`;
        }

        function updateProgress(percent) {
            document.getElementById('progressFill').style.width = percent + '%';
        }

        function addFrequencyDisplay(freq, char) {
            const display = document.getElementById('frequencyDisplay');
            const item = document.createElement('div');
            item.className = 'frequency-item';
            item.innerHTML = `
                <div class="frequency-value">${freq.toFixed(1)}Hz</div>
                <div class="frequency-char">'${char}'</div>
            `;
            display.appendChild(item);
            
            // Keep only last 10 items
            while (display.children.length > 10) {
                display.removeChild(display.firstChild);
            }
        }

        function showAIValidation(original, validated) {
            const validationDiv = document.getElementById('aiValidationResults');
            const detailsDiv = document.getElementById('validationDetails');
            
            const changes = original !== validated;
            detailsDiv.innerHTML = `
                <div class="validation-item">
                    <svg class="validation-check" viewBox="0 0 24 24">
                        <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M11,16.5L6.5,12L7.91,10.59L11,13.67L16.59,8.09L18,9.5L11,16.5Z"/>
                    </svg>
                    HTML structure validated
                </div>
                <div class="validation-item">
                    <svg class="validation-check" viewBox="0 0 24 24">
                        <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M11,16.5L6.5,12L7.91,10.59L11,13.67L16.59,8.09L18,9.5L11,16.5Z"/>
                    </svg>
                    Syntax errors corrected
                </div>
                <div class="validation-item">
                    <svg class="validation-check" viewBox="0 0 24 24">
                        <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M11,16.5L6.5,12L7.91,10.59L11,13.67L16.59,8.09L18,9.5L11,16.5Z"/>
                    </svg>
                    ${changes ? 'Content improved by AI' : 'No changes needed'}
                </div>
            `;
            
            validationDiv.style.display = 'block';
        }

        function generateAnalysisReport(frequencyLog) {
            const dataPoints = frequencyLog.filter(f => f.character);
            const totalFrequencies = frequencyLog.length;
            const successRate = ((dataPoints.length / totalFrequencies) * 100).toFixed(1);
            
            let report = `
                <div class="card">
                    <h4 style="margin-bottom: 16px;">Frequency Analysis Report</h4>
                    <p><strong>Total Frequencies Analyzed:</strong> ${totalFrequencies}</p>
                    <p><strong>Characters Decoded:</strong> ${dataPoints.length}</p>
                    <p><strong>Success Rate:</strong> ${successRate}%</p>
                    <p><strong>Tolerance Used:</strong> ±10Hz</p>
                </div>
                <div class="card" style="margin-top: 20px;">
                    <h4 style="margin-bottom: 16px;">Frequency Mapping Details</h4>
                    <div style="max-height: 300px; overflow-y: auto;">
            `;
            
            dataPoints.forEach(point => {
                report += `
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--card-border);">
                        <span>${point.time}s</span>
                        <span>${point.frequency.toFixed(1)}Hz</span>
                        <span>'${point.character}'</span>
                        <span>${(point.magnitude * 100).toFixed(1)}%</span>
                    </div>
                `;
            });
            
            report += '</div></div>';
            return report;
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        // FFT Implementation (same as before)
        function performFFT(samples, sampleRate) {
            const fftSize = samples.length;
            const magnitudes = new Array(fftSize / 2).fill(0);
            
            for (let k = 0; k < fftSize / 2; k++) {
                let real = 0;
                let imag = 0;
                
                for (let n = 0; n < fftSize; n++) {
                    const angle = (2 * Math.PI * k * n) / fftSize;
                    real += samples[n] * Math.cos(angle);
                    imag -= samples[n] * Math.sin(angle);
                }
                
                magnitudes[k] = Math.sqrt(real * real + imag * imag) / fftSize;
            }
            
            let peakIndex = 0;
            let peakMagnitude = 0;
            
            for (let i = 0; i < magnitudes.length; i++) {
                if (magnitudes[i] > peakMagnitude) {
                    peakMagnitude = magnitudes[i];
                    peakIndex = i;
                }
            }
            
            const peakFrequency = (peakIndex * sampleRate) / fftSize;
            
            return {
                magnitudes,
                peak: {
                    frequency: peakFrequency,
                    magnitude: peakMagnitude,
                    index: peakIndex
                }
            };
        }

        // Event Listeners
        document.getElementById('audioFile').addEventListener('change', function() {
            const decodeBtn = document.getElementById('decodeBtn');
            decodeBtn.disabled = !this.files[0];
            
            if (this.files[0]) {
                showStatus(`Selected: ${this.files[0].name}`, 'info');
            }
        });

        document.getElementById('aiValidation').addEventListener('change', function() {
            const apiKeyDiv = document.getElementById('aiApiKey');
            apiKeyDiv.style.display = this.checked ? 'block' : 'none';
        });

        // Drag and drop functionality
        const uploadSection = document.getElementById('uploadSection');
        
        uploadSection.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
        });
        
        uploadSection.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
        });
        
        uploadSection.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type.startsWith('audio/')) {
                document.getElementById('audioFile').files = files;
                document.getElementById('decodeBtn').disabled = false;
                showStatus(`Selected: ${files[0].name}`, 'info');
            }
        });

        // Navbar scroll effect
        window.addEventListener('scroll', function() {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });
    </script>
</body>
</html>